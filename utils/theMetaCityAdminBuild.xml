<?xml version="1.0"?>
<project name="theMetaCity Admin Build" default="package" basedir="../theMetaCityAdmin">

    <property name="classpath.dir" value="/usr/local/tomcat/lib"/>
    <property name="deployapp.name" value="admin"/>
    <property name="deploy.dir" value="/Users/doug/Sites/theMetaCity/"/>
    <property name="webinflib.dir" value="./WEB-INF/lib"/>

    <target name="clean">
        <delete file="${deploy.dir}/${deployapp.name}.war"/>
        <delete dir="${deploy.dir}/${deployapp.name}"/>
    </target>

    <!-- Include on the the classes for development -->
    <target name="package" depends="clean">
        <jar destfile="${deploy.dir}/${deployapp.name}.war" basedir="${basedir}"/>
    </target>

    <target name="testpropackage" depends="clean">
        <move file="META-INF/context.xml" toFile="META-INF/context.backup" />
        <copy file="../utils/admincontext.xml" toFile="META-INF/context.xml" />
        
        <jar destfile="${deploy.dir}/${deployapp.name}.war" basedir="${basedir}"
            excludes="**/*.backup"
             update="true" />
             
        <move file="META-INF/context.backup" toFile="META-INF/context.xml" overwrite="true"/>             
    </target>

    <!-- Production ready packaging -->
    <target name="production">
        <move file="META-INF/context.xml" toFile="META-INF/context.backup" />
        <copy file="../utils/admincontext.xml" toFile="META-INF/context.xml" />

        <move file="WEB-INF/classes/log4j.properties" toFile="WEB-INF/classes/log4jproperties.backup" />
        <copy file="../utils/log4jadmin.properties" toFile="WEB-INF/classes/log4j.properties" />

        <jar destfile="../${deployapp.name}.war" basedir="${basedir}"
             excludes="**/*.backup"
             update="true" />
        
        <move file="META-INF/context.backup" toFile="META-INF/context.xml" overwrite="true"/>
        <move file="WEB-INF/classes/log4jproperties.backup" toFile="WEB-INF/classes/log4j.properties" overwrite="true"/>
    </target>
</project>
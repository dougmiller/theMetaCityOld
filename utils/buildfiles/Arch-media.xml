<?xml version="1.0"?>
<project name="media" default="development" basedir="../../">   <!-- We take care of the specific dir to copy below ** -->
    <property name="app.name" value="media"/>
    <property name="deploy.dir" value="/srv/http/localcity"/>
    <property name="production.dir" value="/media/tmc/"/>
    <property name="utilities.dir" value="${basedir}/utils"/>    

    <target name="clean">
        <delete dir="${deploy.dir}/${app.name}/css"/>
		<delete dir="${deploy.dir}/${app.name}/js"/>
		<delete dir="${deploy.dir}/${app.name}/site-images"/>
    </target>

    <target name="prodclean">
        <delete dir="${production.dir}/${app.name}/css"/>
		<delete dir="${production.dir}/${app.name}/js"/>
		<delete dir="${production.dir}/${app.name}/site-images"/>
    </target>

    <target name="development" depends="clean">
        <exec executable="utils/cssdevelopmentprocessor" failonerror="true" osfamily="unix"/>                  <!-- Process the files through the LESS preprocessor -->

        <copy todir="${deploy.dir}/${app.name}/css">			<!-- *here* -->
            <fileset dir="${app.name}/css" includes="*.css" />
        </copy>
        <delete>			<!-- Remove unused (sopied across already) files -->
            <fileset dir="${app.name}/css" includes="*.css" />
        </delete>

        <copy todir="${deploy.dir}/${app.name}/js">			<!-- *here* -->
            <fileset dir="${app.name}/js" includes="*.js" />
        </copy>

        <copy todir="${deploy.dir}/${app.name}/site-images">			<!-- *here* -->
            <fileset dir="${app.name}/site-images" includes="*.*" />
        </copy>
    </target>

    <target name="production" depends="prodclean">
        <!-- CSS time -->
        <exec executable="utils/cssproductionprocessor" failonerror="true" osfamily="unix"/>                  <!-- Process the files through the LESS preprocessor and smush them togeather for fewer requests-->
        <copy todir="${production.dir}/${app.name}/css">			<!-- *here* -->
			<fileset dir="${app.name}/css">
  				<include name="screen.css"/>
  				<include name="print.css"/>
			</fileset>
        </copy>

        <delete>
            <fileset dir="${app.name}/css/" includes="*.css"/>         <!-- We dont need them here anymore sice the app is deployed -->
        </delete>

        <!-- JS time -->
        <exec executable="utils/jscombiner" failonerror="true" osfamily="unix"/>                  <!-- Smash the files together to optimise requests -->
        <copy todir="${production.dir}/${app.name}/js">			   <!-- *here* -->
			<fileset dir="${app.name}/js">
  				<include name="tmcsearcher.js"/>
  				<include name="tmcvideo.js"/>
  				<include name="ga.js"/>
			</fileset>
		</copy>
        <delete file="${app.name}/js/tmcsearcher.js"/>           <!-- We dont need this here anymore sice the app is deployed -->
        <delete file="${app.name}/js/tmcvideo.js"/>              <!-- We dont need this here anymore sice the app is deployed -->

        <!-- Site images time -->
        <copy todir="${production.dir}/${app.name}/site-images">			<!-- *here* -->
            <fileset dir="${app.name}/site-images" includes="*.*" />
        </copy>
    </target>
</project>
